<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YouTube to Audio Converter — ThrasherApps</title>
  <meta name="description" content="Download YouTube videos as audio files (MP3 or M4A). Fast, reliable, and free." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="assets/site.css">
  <style>
    #urlInput {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 16px;
      margin-top: 8px;
    }
    #status {
      min-height: 1.5em;
      padding: 8px 0;
    }
    .format-options {
      display: flex;
      gap: 12px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    .format-option {
      padding: 8px 16px;
      border: 2px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .format-option:hover {
      border-color: var(--color-primary);
    }
    .format-option.selected {
      border-color: var(--color-primary);
      background: #EFF6FF;
    }
    .format-option input {
      margin-right: 6px;
    }
    .video-info {
      display: none;
      margin-top: 16px;
      padding: 12px;
      background: #F8FAFC;
      border-radius: 8px;
      border: 1px solid var(--border);
    }
    .video-info.show {
      display: block;
    }
  </style>
</head>
<body>

  <!-- Sticky Header / Nav -->
  <header class="site-header">
    <div class="container nav">
      <a class="brand" href="/">ThrasherApps</a>
      <nav class="nav-links">
        <a href="/">Home</a>
        <a href="apps.html">Apps</a>
        <a href="ai.html">AI Solutions</a>
        <a href="grc-lab.html">GRC Lab</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Main Section -->
  <section class="section">
    <div class="container">
      <h1 class="h2">YouTube to Audio Converter</h1>
      <p class="lead">
        Paste a YouTube link below and download it as an audio file (MP3 or M4A).
        High-quality audio extraction powered by our backend service.
      </p>

      <div class="card mt-3">
        <form id="convertForm">
          <label for="urlInput"><strong>YouTube URL</strong></label>
          <input 
            type="text" 
            id="urlInput" 
            placeholder="https://www.youtube.com/watch?v=... or https://youtu.be/..."
            required 
          />

          <div class="format-options">
            <label class="format-option selected">
              <input type="radio" name="format" value="mp3" checked>
              <span><strong>MP3</strong> (Universal, 192kbps)</span>
            </label>
            <label class="format-option">
              <input type="radio" name="format" value="m4a">
              <span><strong>M4A</strong> (iPhone optimized, better quality)</span>
            </label>
          </div>

          <button class="btn mt-3" id="convertBtn" type="submit">
            Download Audio
          </button>
        </form>

        <div id="videoInfo" class="video-info">
          <strong>Video:</strong> <span id="videoTitle"></span><br>
          <strong>Duration:</strong> <span id="videoDuration"></span>
        </div>

        <p id="status" class="small mt-2"></p>

        <p class="small mt-3">
          <strong>How it works:</strong> Enter any YouTube URL, choose your format, and click Download Audio.
          The audio is extracted server-side and sent directly to your device.
        </p>
      </div>

      <div class="card mt-3">
        <h3>Supported URLs</h3>
        <p class="mt-2">
          • Standard videos: <code>youtube.com/watch?v=...</code><br>
          • Short URLs: <code>youtu.be/...</code><br>
          • Shorts: <code>youtube.com/shorts/...</code><br>
          • Most public YouTube videos
        </p>
        <p class="mt-2 small">
          <strong>Note:</strong> Private videos, age-restricted content, and live streams may not work.
          Very long videos (2+ hours) may take several minutes to process.
        </p>
      </div>
    </div>
  </section>

  <!-- CTA Band -->
  <section class="section cta-band">
    <div class="container wrap">
      <p class="lead">Need a custom web tool for your business?</p>
      <p><a class="btn" href="contact.html">Start a Project</a></p>
    </div>
  </section>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container">
      <div>© 2025 ThrasherApps.com — Built by Chris Thrasher</div>
      <div class="mt-2">
        <a href="mailto:cbthrasher2020@gmail.com">Email</a> ·
        <a href="privacy.html">Privacy</a> ·
        <a target="_blank" href="https://christhrasher.wordpress.com/2025/08/02/trialmate-end-user-license-agreement-eula/">EULA</a>
      </div>
    </div>
  </footer>

  <!-- Navigation highlight script -->
  <script>
    (function () {
      const here = location.pathname.split('/').pop() || 'index.html';
      document.querySelectorAll('.nav-links a').forEach(a=>{
        const target = a.getAttribute('href');
        if ((here === 'index.html' && target === '/') || here === target) a.classList.add('active');
      });

      // Format option styling
      document.querySelectorAll('.format-option').forEach(opt => {
        opt.addEventListener('click', function() {
          document.querySelectorAll('.format-option').forEach(o => o.classList.remove('selected'));
          this.classList.add('selected');
          this.querySelector('input').checked = true;
        });
      });
    })();
  </script>

  <script>
    // Your Vercel backend URL
    const API_URL = 'https://youtube-audio-8g8x8m7tt-chris-thrashers-projects.vercel.app';

    const form = document.getElementById('convertForm');
    const statusEl = document.getElementById('status');
    const convertBtn = document.getElementById('convertBtn');
    const urlInput = document.getElementById('urlInput');
    const videoInfo = document.getElementById('videoInfo');
    const videoTitle = document.getElementById('videoTitle');
    const videoDuration = document.getElementById('videoDuration');

    function setStatus(text, isError = false) {
      statusEl.textContent = text;
      statusEl.style.color = isError ? '#B91C1C' : 'var(--text-muted)';
    }

    function formatDuration(seconds) {
      const h = Math.floor(seconds / 3600);
      const m = Math.floor((seconds % 3600) / 60);
      const s = seconds % 60;
      if (h > 0) return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
      return `${m}:${s.toString().padStart(2, '0')}`;
    }

    // Optional: Get video info first
    urlInput.addEventListener('blur', async () => {
      const url = urlInput.value.trim();
      if (!url || !url.includes('youtube.com') && !url.includes('youtu.be')) return;

      try {
        const response = await fetch(`${API_URL}/api/info`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url })
        });

        if (response.ok) {
          const data = await response.json();
          videoTitle.textContent = data.title;
          videoDuration.textContent = formatDuration(data.duration);
          videoInfo.classList.add('show');
        }
      } catch (err) {
        // Silently fail - info is optional
      }
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const url = urlInput.value.trim();
      if (!url) {
        setStatus('Please enter a YouTube URL', true);
        return;
      }

      const format = document.querySelector('input[name="format"]:checked').value;

      convertBtn.disabled = true;
      const originalBtnText = convertBtn.textContent;
      convertBtn.textContent = 'Processing...';
      setStatus('Connecting to server...');

      try {
        setStatus('Downloading and converting audio... This may take 30-60 seconds.');

        const response = await fetch(`${API_URL}/api/download`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url, format })
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error || 'Download failed');
        }

        // Get the filename from the response headers
        const contentDisposition = response.headers.get('Content-Disposition');
        let filename = `audio.${format}`;
        if (contentDisposition) {
          const matches = /filename="(.+)"/.exec(contentDisposition);
          if (matches) filename = matches[1];
        }

        // Download the file
        const blob = await response.blob();
        const downloadUrl = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = downloadUrl;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(downloadUrl);

        setStatus('✓ Download complete! Check your downloads folder.');

      } catch (err) {
        console.error(err);
        
        let errorMsg = '❌ Download failed. ';
        if (err.message.includes('format')) {
          errorMsg += 'This video format may not be supported.';
        } else if (err.message.includes('available')) {
          errorMsg += 'Video may be private or unavailable.';
        } else if (err.message.includes('network') || err.message.includes('fetch')) {
          errorMsg += 'Could not connect to server. Please try again.';
        } else {
          errorMsg += err.message || 'Please try a different video.';
        }
        
        setStatus(errorMsg, true);
      } finally {
        convertBtn.disabled = false;
        convertBtn.textContent = originalBtnText;
      }
    });
  </script>
</body>
</html>
