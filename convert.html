<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Video to MP3 Converter — ThrasherApps</title>
  <meta name="description" content="Convert a local video file to MP3 directly in your browser. No uploads, no servers — all on-device." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="assets/site.css">
  <style>
    /* Page-specific small tweaks */
    #videoFile {
      width: 100%;
      margin-top: 4px;
    }
    #status {
      min-height: 1.2em;
    }
  </style>
</head>
<body>

  <!-- Sticky Header / Nav (same as index.html) -->
  <header class="site-header">
    <div class="container nav">
      <a class="brand" href="/">ThrasherApps</a>
      <nav class="nav-links">
        <a href="/">Home</a>
        <a href="apps.html">Apps</a>
        <a href="ai.html">AI Solutions</a>
        <a href="grc-lab.html">GRC Lab</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Main Section -->
  <section class="section">
    <div class="container">
      <h1 class="h2">Video to MP3 Converter</h1>
      <p class="lead">
        Download your video (for example, from YouTube), then convert it here to an MP3 you can play offline on your
        iPhone or Android. Everything runs in your browser—nothing is uploaded to my server.
      </p>

      <div class="card mt-3">
        <form id="convertForm">
          <label for="videoFile">Choose a video file</label>
          <input type="file" id="videoFile" accept="video/*" required />
          <button class="btn mt-2" id="convertBtn" type="submit" disabled>
            Loading converter…
          </button>
        </form>

        <p id="status" class="small mt-2"></p>

        <p class="small mt-2">
          Tip: The first time you use this, it may take a bit while the converter loads. Very large videos can be slow,
          especially on older phones.
        </p>
      </div>
    </div>
  </section>

  <!-- CTA Band (optional reuse for consistency) -->
  <section class="section cta-band">
    <div class="container wrap">
      <p class="lead">Need a custom tool like this for your team or business?</p>
      <p><a class="btn" href="contact.html">Start a Project</a></p>
    </div>
  </section>

  <!-- Footer (same as index.html) -->
  <footer class="site-footer">
    <div class="container">
      <div>© 2025 ThrasherApps.com — Built by Chris Thrasher</div>
      <div class="mt-2">
        <a href="mailto:cbthrasher2020@gmail.com">Email</a> ·
        <a href="privacy.html">Privacy</a> ·
        <a target="_blank" href="https://christhrasher.wordpress.com/2025/08/02/trialmate-end-user-license-agreement-eula/">EULA</a>
      </div>
    </div>
  </footer>

  <!-- Tiny scroll-reveal helper + nav highlighter (same as index.html) -->
  <script>
    (function () {
      const els = document.querySelectorAll('.reveal');
      const onObs = entries => entries.forEach(e=>{
        if (e.isIntersecting){ e.target.classList.add('in'); obs.unobserve(e.target); }
      });
      const obs = ('IntersectionObserver' in window) ? new IntersectionObserver(onObs, {threshold: 0.08}) : null;
      els.forEach(el => { if (obs) obs.observe(el); else el.classList.add('in'); });

      // highlight current nav link
      const here = location.pathname.split('/').pop() || 'index.html';
      document.querySelectorAll('.nav-links a').forEach(a=>{
        const target = a.getAttribute('href');
        if ((here === 'index.html' && target === '/') || here === target) a.classList.add('active');
      });
    })();
  </script>

  <!-- FFmpeg WASM converter: all in-browser -->
  <script type="module">
    import { createFFmpeg, fetchFile } from 'https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/ffmpeg.min.js';

    const ffmpeg = createFFmpeg({ log: true });
    let ffmpegLoaded = false;

    const form = document.getElementById('convertForm');
    const statusEl = document.getElementById('status');
    const convertBtn = document.getElementById('convertBtn');
    const fileInput = document.getElementById('videoFile');

    function setStatus(text) {
      statusEl.textContent = text;
    }

    async function loadFFmpegOnce() {
      if (ffmpegLoaded) return;
      setStatus('Loading converter (first time only)…');
      try {
        await ffmpeg.load();
        ffmpegLoaded = true;
        setStatus('Converter ready. Select a video and tap “Convert to MP3”.');
        convertBtn.disabled = false;
        convertBtn.textContent = 'Convert to MP3';
      } catch (err) {
        console.error(err);
        setStatus('Failed to load converter. Please refresh the page and try again.');
      }
    }

    // Start loading FFmpeg as soon as the page loads
    loadFFmpegOnce();

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const file = fileInput.files[0];
      if (!file) {
        setStatus('Please choose a video file first.');
        return;
      }

      if (!ffmpegLoaded) {
        setStatus('Still loading converter… please wait a moment.');
        return;
      }

      convertBtn.disabled = true;
      const originalBtnText = convertBtn.textContent;
      convertBtn.textContent = 'Converting…';
      setStatus('Converting to MP3. This may take a bit…');

      try {
        // Write the input file into ffmpeg’s virtual file system
        ffmpeg.FS('writeFile', 'input', await fetchFile(file));

        // Run FFmpeg to extract audio as MP3
        await ffmpeg.run(
          '-i', 'input',
          '-vn',
          '-acodec', 'libmp3lame',
          '-b:a', '192k',
          'output.mp3'
        );

        // Read the output data
        const data = ffmpeg.FS('readFile', 'output.mp3');

        // Convert to Blob and trigger download
        const blob = new Blob([data.buffer], { type: 'audio/mpeg' });
        const originalName = file.name.replace(/\.[^/.]+$/, '') || 'audio';

        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = originalName + '.mp3';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);

        setStatus('Done! Check your downloads for the new MP3 file.');

        // Cleanup in the virtual FS
        ffmpeg.FS('unlink', 'input');
        ffmpeg.FS('unlink', 'output.mp3');
      } catch (err) {
        console.error(err);
        setStatus('Conversion failed. Try a smaller or different video file.');
      } finally {
        convertBtn.disabled = false;
        convertBtn.textContent = originalBtnText;
      }
    });
  </script>
</body>
</html>
